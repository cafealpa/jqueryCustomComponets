<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SI 프로젝트 공통 컴포넌트 테스트</title>
    <!-- JQuery CDN (폐쇄망에서는 로컬 파일로 대체하세요) -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
    <style>
        /* SI 프로젝트 스타일의 간단한 CSS */
        body { font-family: 'Malgun Gothic', 'Dotum', sans-serif; font-size: 14px; background-color: #f4f6f9; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; background: #fff; padding: 20px; border: 1px solid #ddd; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        h1 { font-size: 20px; border-bottom: 2px solid #333; padding-bottom: 10px; margin-bottom: 20px; color: #333; }
        
        /* 테이블 스타일 폼 */
        .form-table { width: 100%; border-collapse: collapse; border-top: 2px solid #5d5d5d; }
        .form-table th { background-color: #f0f0f0; border-bottom: 1px solid #ddd; padding: 10px; text-align: left; width: 150px; font-weight: bold; color: #333; }
        .form-table td { border-bottom: 1px solid #ddd; padding: 8px 10px; }
        
        /* 인풋 스타일 */
        input[type="text"], select { height: 32px; padding: 0 8px; border: 1px solid #ccc; width: 100%; box-sizing: border-box; outline: none; transition: border-color 0.2s; }
        input[type="text"]:focus { border-color: #007bff; }
        input[readonly] { background-color: #f9f9f9; color: #777; }
        
        /* 유틸리티 클래스 */
        .required::before { content: '*'; color: #e74c3c; margin-right: 4px; }
        .text-right { text-align: right; }
        .w-50 { width: 50% !important; }
        .w-30 { width: 30% !important; }
        .btn-area { margin-top: 20px; text-align: center; }
        
        /* 버튼 스타일 */
        button { padding: 10px 20px; border: none; cursor: pointer; font-weight: bold; font-size: 14px; min-width: 80px; }
        .btn-primary { background-color: #007bff; color: white; }
        .btn-primary:hover { background-color: #0056b3; }
        .btn-secondary { background-color: #6c757d; color: white; }
    </style>
</head>
<body>

<div class="container">
    <h1>임직원 정보 등록 (테스트)</h1>
    
    <table class="form-table">
        <tr>
            <th class="required">성명</th>
            <td><input type="text" id="userName" class="w-50" placeholder="한글/영문 입력"></td>
        </tr>
        <tr>
            <th class="required">사번 (숫자)</th>
            <td><input type="text" id="empId" class="w-30" placeholder="숫자만 입력"></td>
        </tr>
        <tr>
            <th class="required">휴대전화</th>
            <td><input type="text" id="mobileNo" class="w-50" placeholder="숫자만 입력 (자동 하이픈)"></td>
        </tr>
        <tr>
            <th>이메일</th>
            <td><input type="text" id="email" placeholder="example@company.com"></td>
        </tr>
        <tr>
            <th class="required">연봉 (계약)</th>
            <td><input type="text" id="salary" class="text-right w-50" placeholder="숫자만 입력 (자동 콤마)"> 원</td>
        </tr>
        <tr>
            <th>입사일자</th>
            <td><input type="text" id="joinDate" class="w-30" placeholder="YYYY-MM-DD (자동 포맷)"></td>
        </tr>
    </table>

    <div class="btn-area">
        <button type="button" class="btn-secondary" onclick="window.location.reload()">초기화</button>
        <button type="button" class="btn-primary" id="btnSave">저장</button>
    </div>
</div>

<script>
/**
 * [Common] SI 공통 스크립트 영역
 * (실제 프로젝트에서는 common.js 파일로 분리하세요)
 */
(function($) {
    /**
     * [UI Component] 입력값 유효성 검사 (Validation Check)
     * * @description
     * 입력 필드(input, select 등)의 값에 대해 필수 입력, 길이 제한, 숫자 전용, 정규식 검사를 수행합니다.
     * 단일 항목에 대한 검증 결과를 반환하며, 주로 저장/수정 버튼 클릭 시 호출하여 사용합니다.
     * * @param {Object} options - 유효성 검사 옵션 객체
     * @param {string}  options.name       - (필수 권장) 경고창(alert) 메시지에 표시될 항목의 한글 명칭 (예: '성명', '전화번호')
     * @param {boolean} [options.required] - 필수 입력 여부 (true: 필수, false: 선택). 기본값 false.
     * @param {number}  [options.maxLength]- 최대 입력 길이 제한. 0보다 크면 길이 체크 수행. 기본값 0.
     * @param {boolean} [options.numberOnly]- 숫자만 입력되었는지 여부 체크. 콤마(,)는 제거하고 체크함. 기본값 false.
     * @param {RegExp}  [options.regex]    - 커스텀 정규식 패턴 (예: 이메일, 전화번호 형식 등).
     * @param {string}  [options.regexMsg] - 정규식 검증 실패 시 출력할 에러 메시지.
     * * @returns {Object} result
     * @returns {boolean} result.isValid - 검증 통과 여부 (true: 통과, false: 실패)
     * @returns {string}  result.msg     - 검증 실패 시 사용자에게 보여줄 에러 메시지
     * * @example
     * var result = $('#userName').checkValidation({
     * name: '성명',
     * required: true,
     * maxLength: 10
     * });
     * if (!result.isValid) alert(result.msg);
     */
    $.fn.checkValidation = function(options) {
        var settings = $.extend({
            name: '항목', required: false, maxLength: 0, numberOnly: false, regex: null, regexMsg: '형식이 올바르지 않습니다.'
        }, options);

        var $this = $(this);
        var val = $.trim($this.val());
        var result = { isValid: true, msg: '' };

        // 필수 체크
        if (settings.required && (val === '' || val === null)) {
            return { isValid: false, msg: settings.name + '은(는) 필수 입력 항목입니다.' };
        }
        if (val === '') return result;

        // 길이 체크
        if (settings.maxLength > 0 && val.length > settings.maxLength) {
            return { isValid: false, msg: settings.name + '은(는) ' + settings.maxLength + '자 이내로 입력해주세요.' };
        }

        // 숫자 전용 체크 (콤마/하이픈 제거 후 체크하는 것이 일반적이나, 여기선 순수 입력값 기준)
        if (settings.numberOnly) {
            if (!/^[0-9]+$/.test(val.replace(/,/g, ''))) { // 콤마가 있어도 숫자로 인정하는 로직 추가
                return { isValid: false, msg: settings.name + '은(는) 숫자만 입력 가능합니다.' };
            }
        }

        // 정규식 체크
        if (settings.regex) {
            var pattern = (typeof settings.regex === 'string') ? new RegExp(settings.regex) : settings.regex;
            if (!pattern.test(val)) {
                return { isValid: false, msg: settings.regexMsg };
            }
        }
        return result;
    };

    /**
     * [UI Component] 입력값 자동 포맷팅 (Auto Formatting)
     * * @description
     * 사용자가 입력하는 즉시(input, keyup 이벤트) 지정된 포맷으로 값을 변환하여 보여줍니다.
     * 숫자 이외의 문자는 제거되며, 각 타입에 맞는 구분자(-, ,)가 자동으로 삽입됩니다.
     * * @param {string} type - 포맷 타입 지정
     * - 'phone' : 전화번호/휴대전화 번호 (010-1234-5678, 02-123-4567 등 지역번호 대응)
     * - 'money' : 금액 표기 (천단위 콤마 삽입, 1,000,000)
     * - 'date'  : 날짜 표기 (YYYY-MM-DD, 2025-12-11)
     * - 'number': 순수 숫자만 허용 (문자 입력 방지)
     * * @example
     * $('#telNo').autoFormat('phone');
     * $('.money-input').autoFormat('money');
     */
    $.fn.autoFormat = function(type) {
        return this.each(function() {
            var $this = $(this);
            $this.on('input keyup', function() {
                var val = $this.val();
                var cleanVal = val.replace(/[^0-9]/g, '');
                if (!cleanVal) { $this.val(''); return; }
                
                var formattedVal = '';
                switch (type) {
                    case 'phone':
                        if (cleanVal.length < 4) formattedVal = cleanVal;
                        else if (cleanVal.length < 7) formattedVal = cleanVal.substr(0, 3) + '-' + cleanVal.substr(3);
                        else if (cleanVal.length < 11) {
                            formattedVal = (cleanVal.substr(0, 2) === '02') 
                                ? cleanVal.substr(0, 2) + '-' + cleanVal.substr(2, 3) + '-' + cleanVal.substr(5)
                                : cleanVal.substr(0, 3) + '-' + cleanVal.substr(3, 3) + '-' + cleanVal.substr(6);
                        } else {
                            formattedVal = (cleanVal.substr(0, 2) === '02')
                                ? cleanVal.substr(0, 2) + '-' + cleanVal.substr(2, 4) + '-' + cleanVal.substr(6)
                                : cleanVal.substr(0, 3) + '-' + cleanVal.substr(3, 4) + '-' + cleanVal.substr(7);
                        }
                        if (formattedVal.length > 13) formattedVal = formattedVal.substring(0, 13);
                        break;
                    case 'money':
                        formattedVal = parseInt(cleanVal, 10).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
                        break;
                    case 'date':
                        if (cleanVal.length < 5) formattedVal = cleanVal;
                        else if (cleanVal.length < 7) formattedVal = cleanVal.substr(0, 4) + '-' + cleanVal.substr(4);
                        else formattedVal = cleanVal.substr(0, 4) + '-' + cleanVal.substr(4, 2) + '-' + cleanVal.substr(6);
                        if (formattedVal.length > 10) formattedVal = formattedVal.substring(0, 10);
                        break;
                    case 'number':
                        formattedVal = cleanVal; break;
                }
                $this.val(formattedVal);
            });
        });
    };
})(jQuery);

/**
 * [Utility] 데이터 정제 함수
 * * @description
 * 서버 전송 전, 화면에 표시된 포맷팅 문자(콤마, 하이픈 등)를 제거하고 순수 숫자 데이터만 추출합니다.
 * * @param {string} id - 값을 추출할 DOM ID (예: '#salary')
 * @returns {string} - 숫자만 남은 문자열
 */
function getCleanVal(id) {
    return $(id).val().replace(/[^0-9]/g, '');
}

/**
 * [Page] 화면별 스크립트
 */
$(document).ready(function() {

    // [Step 1] 입력 마스크 적용 (Input Masking)
    $('#empId').autoFormat('number');    // 숫자만
    $('#mobileNo').autoFormat('phone');  // 전화번호
    $('#salary').autoFormat('money');    // 금액
    $('#joinDate').autoFormat('date');   // 날짜

    // [Step 2] 저장 버튼 이벤트
    $('#btnSave').on('click', function() {
        
        // --- 1. 성명 검증 (필수, 5자 이내)
        var v1 = $('#userName').checkValidation({
            name: '성명', required: true, maxLength: 5
        });
        if(!v1.isValid) { alert(v1.msg); $('#userName').focus(); return; }

        // --- 2. 사번 검증 (필수, 숫자만)
        var v2 = $('#empId').checkValidation({
            name: '사번', required: true, numberOnly: true
        });
        if(!v2.isValid) { alert(v2.msg); $('#empId').focus(); return; }

        // --- 3. 휴대전화 검증 (필수, 정규식)
        var v3 = $('#mobileNo').checkValidation({
            name: '휴대전화', required: true, 
            regex: /^01([0|1|6|7|8|9])-?([0-9]{3,4})-?([0-9]{4})$/,
            regexMsg: '휴대전화 형식이 올바르지 않습니다. (010-XXXX-XXXX)'
        });
        if(!v3.isValid) { alert(v3.msg); $('#mobileNo').focus(); return; }

        // --- 4. 이메일 검증 (선택입력, 형식이 있다면 체크)
        var v4 = $('#email').checkValidation({
            name: '이메일', required: false,
            regex: /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/,
            regexMsg: '이메일 주소를 확인해주세요.'
        });
        if(!v4.isValid) { alert(v4.msg); $('#email').focus(); return; }

        // --- 5. 연봉 검증 (필수)
        var v5 = $('#salary').checkValidation({
            name: '연봉', required: true
        });
        if(!v5.isValid) { alert(v5.msg); $('#salary').focus(); return; }

        // --- 6. 입사일자 검증 (선택, 날짜 형식 완벽 체크)
        // 단순 길이 체크가 아니라 실제 존재하는 날짜인지 정규식 활용
        var v6 = $('#joinDate').checkValidation({
            name: '입사일자', required: false,
            regex: /^\d{4}-(0[1-9]|1[0-2])-(0[1-9]|[12][0-9]|3[01])$/,
            regexMsg: '유효한 날짜가 아닙니다. (YYYY-MM-DD)'
        });
        if(!v6.isValid) { alert(v6.msg); $('#joinDate').focus(); return; }

        // [Step 3] 데이터 전송 준비 (콤마 제거 등)
        var saveData = {
            user_name: $('#userName').val(),
            emp_id: $('#empId').val(),
            mobile_no: getCleanVal('#mobileNo'), // 01012341234
            email: $('#email').val(),
            salary: getCleanVal('#salary'),      // 50000000
            join_date: getCleanVal('#joinDate')  // 20251211
        };

        // 결과 확인
        alert('유효성 검사 통과!\n\n[서버 전송 데이터]\n' + JSON.stringify(saveData, null, 2));
        console.log(saveData);
    });
});
</script>

</body>
</html>